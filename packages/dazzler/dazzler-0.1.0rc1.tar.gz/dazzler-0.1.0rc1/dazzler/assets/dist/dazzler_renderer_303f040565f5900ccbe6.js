!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react"),require("react-dom")):"function"==typeof define&&define.amd?define(["react","react-dom"],t):"object"==typeof exports?exports.dazzler_renderer=t(require("react"),require("react-dom")):e.dazzler_renderer=t(e.React,e.ReactDOM)}(window,function(e,t){return function(e){function t(t){for(var r,a,s=t[0],c=t[1],u=t[2],f=0,l=[];f<s.length;f++)a=s[f],o[a]&&l.push(o[a][0]),o[a]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);for(p&&p(t);l.length;)l.shift()();return i.push.apply(i,u||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],r=!0,s=1;s<n.length;s++){var c=n[s];0!==o[c]&&(r=!1)}r&&(i.splice(t--,1),e=a(a.s=n[0]))}return e}var r={},o={6:0},i=[];function a(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=r,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(n,r,function(t){return e[t]}.bind(null,r));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="";var s=window.webpackJsonpdazzler_name_=window.webpackJsonpdazzler_name_||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var u=0;u<s.length;u++)t(s[u]);var p=c;return i.push([415,0]),n()}({1:function(t,n){t.exports=e},222:function(e,n){e.exports=t},415:function(e,t,n){e.exports=n(617)},617:function(e,t,n){"use strict";n.r(t);var r=n(1),o=n.n(r),i=n(222),a=n.n(i),s=n(0),c=n.n(s),u=n(145),p=n(624),f=n(225),l=n(625),d=n(622),y=n(623),b=n(10);function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){g(e,t,n[t])})}return e}function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function O(e){return(O=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function w(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function j(e,t){return(j=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var k=function(e){function t(e){var n,r,o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,(n=!(o=O(t).call(this,e))||"object"!==h(o)&&"function"!=typeof o?w(r):o).state={aspects:e.aspects||{},ready:!1,initial:!1},n.setAspects=n.setAspects.bind(w(n)),n.getAspect=n.getAspect.bind(w(n)),n.updateAspects=n.updateAspects.bind(w(n)),n}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&j(e,t)}(t,o.a.Component),n=t,(r=[{key:"updateAspects",value:function(e){var t=this;return this.setAspects(e).then(function(){return t.props.updateAspects(t.props.identity,e)})}},{key:"setAspects",value:function(e){var t=this;return new Promise(function(n){t.setState({aspects:m({},t.state.aspects,e)},n)})}},{key:"getAspect",value:function(e){return this.state.aspects[e]}},{key:"componentDidMount",value:function(){var e=this;this.props.connect(this.props.identity,this.setAspects,this.getAspect),this.state.initial||this.updateAspects(this.state.aspects).then(function(){return e.setState({ready:!0,initial:!0})})}},{key:"componentWillUnmount",value:function(){this.props.disconnect(this.props.identity)}},{key:"render",value:function(){var e=this.props,t=e.component,n=e.component_name,r=e.package_name,i=this.state,a=i.aspects;return i.ready?o.a.cloneElement(t,m({},a,{updateAspects:this.updateAspects,identity:this.props.identity,class_name:Object(d.a)(" ",Object(y.a)(["".concat(r.replace("_","-").toLowerCase(),"-").concat(Object(b.camelToSpinal)(n))],a.class_name?a.class_name.split(" "):[]))})):null}}])&&v(n.prototype,r),i&&v(n,i),t}();function _(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){S(e,t,n[t])})}return e}function S(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}k.propTypes={identity:c.a.string.isRequired,updateAspects:c.a.func.isRequired,component:c.a.node.isRequired,connect:c.a.func.isRequired,component_name:c.a.string.isRequired,package_name:c.a.string.isRequired,disconnect:c.a.func.isRequired};var P=/json/i,A={method:"GET",headers:{},payload:"",json:!0},E={"Content-Type":"application/json"};function q(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:A;return new Promise(function(n,r){var o=_({},A,t),i=o.method,a=o.headers,s=o.payload,c=o.json,u=new XMLHttpRequest;u.open(i,e);var p=c?_({},E,a):a;Object.keys(p).forEach(function(e){return u.setRequestHeader(e,p[e])}),u.onreadystatechange=function(){if(u.readyState===XMLHttpRequest.DONE)if(u.status<400){var t=u.response;P.test(u.getResponseHeader("Content-Type"))&&(t=JSON.parse(u.responseText)),n(t)}else r({error:"RequestError",message:"XHR ".concat(e," FAILED - STATUS: ").concat(u.status," MESSAGE: ").concat(u.statusText),status:u.status,xhr:u})},u.onerror=function(e){return r(e)},u.send(c?JSON.stringify(s):s)})}function R(e){return(R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function T(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){x(e,t,n[t])})}return e}function x(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function C(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function M(e){return(M=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function z(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function N(e,t){return(N=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function J(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function U(e){return"Object"===Object(u.a)(e)&&e.hasOwnProperty("package")&&e.hasOwnProperty("aspects")&&e.hasOwnProperty("name")&&e.hasOwnProperty("identity")}function D(e,t,n,r){var o={};return Object.entries(e).forEach(function(e){var i=J(e,2),a=i[0],s=i[1];if("Array"===Object(u.a)(s))o[a]=s.map(function(e){if(!U(e))return e;var o=D(e.aspects,t,n,r);return o.key||(o.key=e.identity),H(e.name,e.package,e.identity,o,t,n,r)});else if(U(s)){var c=D(s.aspects,t,n,r);o[a]=H(s.name,s.package,s.identity,c,t,n,r)}else"Object"===Object(u.a)(s)&&(o[a]=D(s,t,n,r))}),Object(p.a)(e,o)}function H(e,t,n,r,i,a,s){var c=window[t],u=o.a.createElement(c[e],r);return o.a.createElement(k,{identity:n,updateAspects:i,component:u,connect:a,package_name:t,component_name:e,aspects:r,disconnect:s,key:"wrapper-".concat(n)})}function L(e){return o.a.isValidElement(e)?{identity:e.props.identity,aspects:Object(f.a)(L,Object(l.a)(["identity","updateAspects","_name","_package","aspects","key"],e.props.aspects)),name:e.props.component_name,package:e.props.package_name}:"Array"===Object(u.a)(e)?e.map(L):"Object"===Object(u.a)(e)?Object(f.a)(L,e):e}var W=function(e){function t(e){var n,r,o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,(n=!(o=M(t).call(this,e))||"object"!==R(o)&&"function"!=typeof o?z(r):o).state={layout:!1,ready:!1,page:null,bindings:{},packages:[],requirements:[]},n.pageApi=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return function(){var r=!1,o=n+arguments[0],i=arguments[1]||{};return i.headers=_({},e(),i.headers),new Promise(function(n,a){q(o,i).then(n).catch(function(s){401!==s.status||r?a(s):(r=!0,t().then(function(){return q(o,_({},i,{headers:_({},i.headers,e())})).then(n)}).catch(a))})})}}(n.getHeaders.bind(z(n)),n.refresh.bind(z(n)),window.location.href),n.boundComponents={},n.ws=null,n.updateAspects=n.updateAspects.bind(z(n)),n.connect=n.connect.bind(z(n)),n.disconnect=n.disconnect.bind(z(n)),n.onMessage=n.onMessage.bind(z(n)),n}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&N(e,t)}(t,o.a.Component),n=t,(r=[{key:"updateAspects",value:function(e,t){var n=this;return new Promise(function(r){var o=Object.keys(t).map(function(t){return n.state.bindings["".concat(e,".").concat(t)]}).filter(function(e){return e});if(!o)return r(0);o.forEach(function(e){return n.sendBinding(e,t[e.trigger.aspect])}),r()})}},{key:"connect",value:function(e,t,n){this.boundComponents[e]={setAspects:t,getAspect:n}}},{key:"disconnect",value:function(e){delete this.boundComponents[e]}},{key:"onMessage",value:function(e){var t,n=this,r=JSON.parse(e.data),o=r.identity,i=r.kind,a=r.payload,s=r.storage,c=r.request_id;switch(t="session"===s?window.sessionStorage:window.localStorage,i){case"set-aspect":var u=this.boundComponents[o];if(!u){var p="Component not found: ".concat(o);return this.ws.send(JSON.stringify({error:p,kind:"error"})),void console.error(p)}u.setAspects(D(a,this.updateAspects,this.connect,this.disconnect)).then(function(){Object.keys(a).forEach(function(e){var t="".concat(o,".").concat(e),r=n.state.bindings[t];r&&n.sendBinding(r,u.getAspect(e))})});break;case"get-aspect":var f=r.aspect,l=this.boundComponents[o];if(!l)return void this.ws.send(JSON.stringify({kind:i,identity:o,aspect:f,request_id:c,error:"Aspect not found ".concat(o,".").concat(f)}));var d=l.getAspect(f);this.ws.send(JSON.stringify({kind:i,identity:o,aspect:f,value:L(d),request_id:c}));break;case"set-storage":t.setItem(o,JSON.stringify(a));break;case"get-storage":this.ws.send(JSON.stringify({kind:i,identity:o,request_id:c,value:JSON.parse(t.getItem(o))}))}}},{key:"sendBinding",value:function(e,t){var n=this,r={trigger:T({},e.trigger,{value:L(t)}),states:e.states.map(function(e){return T({},e,{value:n.boundComponents[e.identity]&&L(n.boundComponents[e.identity].getAspect(e.aspect))})}),kind:"binding",page:this.state.page,key:e.key};this.ws.send(JSON.stringify(r))}},{key:"loadRequirements",value:function(e,t){var n=this;return new Promise(function(r,o){var i=[];Object.keys(t).forEach(function(e){var r=t[e];i=i.concat(r.requirements.map(n.loadRequirement))}),Promise.all(i).then(function(){var t=0;!function o(){t<e.length?n.loadRequirement(e[t]).then(function(){t++,o()}):r()}()}).catch(o)})}},{key:"loadRequirement",value:function(e){return new Promise(function(t,n){var r,o=e.url,i=e.kind,a=e.meta;if("js"===i)r=b.loadScript;else{if("css"!==i)return"map"===i?t():n({error:"Invalid requirement kind: ".concat(i)});r=b.loadCss}r(o,a).then(t).catch(n)})}},{key:"_connectWS",value:function(){var e=this,t=0;!function n(){e.ws=new WebSocket("ws".concat(window.location.href.startsWith("https")?"s":"","://").concat(e.props.baseUrl&&e.props.baseUrl||window.location.host).concat(window.location.pathname,"/ws")),e.ws.addEventListener("message",e.onMessage),e.ws.onopen=function(){e.setState({ready:!0}),t=0},e.ws.onclose=function(){t<e.props.retries&&setTimeout(function(){t++,n()},1e3)}}()}},{key:"getHeaders",value:function(){return{}}},{key:"refresh",value:function(){}},{key:"componentWillMount",value:function(){var e=this;this.pageApi("",{method:"POST"}).then(function(t){e.setState({page:t.page,layout:t.layout,bindings:t.bindings,packages:t.packages,requirements:t.requirements}),e.loadRequirements(t.requirements,t.packages).then(function(){return e._connectWS()})})}},{key:"render",value:function(){var e=this.state,t=e.layout;if(!e.ready)return o.a.createElement("div",null,"Loading...");if(!U(t))throw new Error("Layout is not a component: ".concat(t));return o.a.createElement("div",{className:"dazzler-rendered"},H(t.name,t.package,t.identity,D(t.aspects,this.updateAspects,this.connect,this.disconnect),this.updateAspects,this.connect,this.disconnect))}}])&&C(n.prototype,r),i&&C(n,i),t}();function I(e){return(I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function B(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function X(e,t){return!t||"object"!==I(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function G(e){return(G=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function F(e,t){return(F=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}W.defaultProps={},W.propTypes={baseUrl:c.a.string.isRequired,ping:c.a.bool,ping_interval:c.a.number,retries:c.a.number};var V=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),X(this,G(t).apply(this,arguments))}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&F(e,t)}(t,o.a.Component),n=t,(r=[{key:"componentWillMount",value:function(){window.dazzler_base_url=this.props.baseUrl}},{key:"render",value:function(){return o.a.createElement("div",{className:"dazzler-renderer"},o.a.createElement(W,this.props))}}])&&B(n.prototype,r),i&&B(n,i),t}();function K(e,t){var n=e.baseUrl,r=e.ping,i=e.ping_interval,s=e.retries;a.a.render(o.a.createElement(V,{baseUrl:n,ping:r,ping_interval:i,retries:s}),t)}V.propTypes={baseUrl:c.a.string.isRequired,ping:c.a.bool,ping_interval:c.a.number,retries:c.a.number},n.d(t,"render",function(){return K}),n.d(t,"Renderer",function(){return V})}})});
//# sourceMappingURL=dazzler_renderer_303f040565f5900ccbe6.js.map