var teramap=function(e){var t={};function o(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,o),n.l=!0,n.exports}return o.m=e,o.c=t,o.d=function(e,t,i){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(i,n,function(t){return e[t]}.bind(null,n));return i},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=15)}([function(e,t){e.exports=L},function(e,t,o){"use strict";o.d(t,"a",function(){return s}),o.d(t,"b",function(){return r});var i=o(0),n=o.n(i),s=(o(3),n.a.NumberIcon=n.a.DivIcon.extend({options:{html:"",shadowUrl:null,iconSize:new n.a.Point(20,20),className:"leaflet-number-marker"}}),n.a.numberIcon=function(e){var t="object"==typeof e?e:{html:e};return new n.a.NumberIcon(t)}),r=n.a.numberMarker=function(e,t){return n.a.marker(e,{icon:n.a.numberIcon(t)})}},function(e,t,o){e.exports=function(e,t,o){var i=!1;if(void 0===window.XMLHttpRequest)return t(Error("Browser not supported"));if(void 0===o){var n=e.match(/^\s*https?:\/\/[^\/]*/);o=n&&n[0]!==location.protocol+"//"+location.hostname+(location.port?":"+location.port:"")}var s=new window.XMLHttpRequest;if(o&&!("withCredentials"in s)){s=new window.XDomainRequest;var r=t;t=function(){if(i)r.apply(this,arguments);else{var e=this,t=arguments;setTimeout(function(){r.apply(e,t)},0)}}}function a(){var e;void 0===s.status||(e=s.status)>=200&&e<300||304===e?t.call(s,null,s):t.call(s,s,null)}return"onload"in s?s.onload=a:s.onreadystatechange=function(){4===s.readyState&&a()},s.onerror=function(e){t.call(this,e||!0,null),t=function(){}},s.onprogress=function(){},s.ontimeout=function(e){t.call(this,e,null),t=function(){}},s.onabort=function(e){t.call(this,e,null),t=function(){}},s.open("GET",e,!0),s.send(null),i=!0,s}},function(e,t,o){},function(e,t,o){var i,n,s;!function(r,a){n=[o(0)],void 0===(s="function"==typeof(i=r)?i.apply(t,n):i)||(e.exports=s),void 0!==a&&a.L&&(a.L.Control.MiniMap=r(L),a.L.control.minimap=function(e,t){return new a.L.Control.MiniMap(e,t)})}(function(e){var t=e.Control.extend({includes:e.Evented?e.Evented.prototype:e.Mixin.Events,options:{position:"bottomright",toggleDisplay:!1,zoomLevelOffset:-5,zoomLevelFixed:!1,centerFixed:!1,zoomAnimation:!1,autoToggleDisplay:!1,minimized:!1,width:150,height:150,collapsedWidth:19,collapsedHeight:19,aimingRectOptions:{color:"#ff7800",weight:1,clickable:!1},shadowRectOptions:{color:"#000000",weight:1,clickable:!1,opacity:0,fillOpacity:0},strings:{hideText:"Hide MiniMap",showText:"Show MiniMap"},mapOptions:{}},initialize:function(t,o){e.Util.setOptions(this,o),this.options.aimingRectOptions.clickable=!1,this.options.shadowRectOptions.clickable=!1,this._layer=t},onAdd:function(t){this._mainMap=t,this._container=e.DomUtil.create("div","leaflet-control-minimap"),this._container.style.width=this.options.width+"px",this._container.style.height=this.options.height+"px",e.DomEvent.disableClickPropagation(this._container),e.DomEvent.on(this._container,"mousewheel",e.DomEvent.stopPropagation);var o={attributionControl:!1,dragging:!this.options.centerFixed,zoomControl:!1,zoomAnimation:this.options.zoomAnimation,autoToggleDisplay:this.options.autoToggleDisplay,touchZoom:this.options.centerFixed?"center":!this._isZoomLevelFixed(),scrollWheelZoom:this.options.centerFixed?"center":!this._isZoomLevelFixed(),doubleClickZoom:this.options.centerFixed?"center":!this._isZoomLevelFixed(),boxZoom:!this._isZoomLevelFixed(),crs:t.options.crs};return o=e.Util.extend(this.options.mapOptions,o),this._miniMap=new e.Map(this._container,o),this._miniMap.addLayer(this._layer),this._mainMapMoving=!1,this._miniMapMoving=!1,this._userToggledDisplay=!1,this._minimized=!1,this.options.toggleDisplay&&this._addToggleButton(),this._miniMap.whenReady(e.Util.bind(function(){this._aimingRect=e.rectangle(this._mainMap.getBounds(),this.options.aimingRectOptions).addTo(this._miniMap),this._shadowRect=e.rectangle(this._mainMap.getBounds(),this.options.shadowRectOptions).addTo(this._miniMap),this._mainMap.on("moveend",this._onMainMapMoved,this),this._mainMap.on("move",this._onMainMapMoving,this),this._miniMap.on("movestart",this._onMiniMapMoveStarted,this),this._miniMap.on("move",this._onMiniMapMoving,this),this._miniMap.on("moveend",this._onMiniMapMoved,this)},this)),this._container},addTo:function(t){e.Control.prototype.addTo.call(this,t);var o=this.options.centerFixed||this._mainMap.getCenter();return this._miniMap.setView(o,this._decideZoom(!0)),this._setDisplay(this.options.minimized),this},onRemove:function(e){this._mainMap.off("moveend",this._onMainMapMoved,this),this._mainMap.off("move",this._onMainMapMoving,this),this._miniMap.off("moveend",this._onMiniMapMoved,this),this._miniMap.removeLayer(this._layer)},changeLayer:function(e){this._miniMap.removeLayer(this._layer),this._layer=e,this._miniMap.addLayer(this._layer)},_addToggleButton:function(){this._toggleDisplayButton=this.options.toggleDisplay?this._createButton("",this._toggleButtonInitialTitleText(),"leaflet-control-minimap-toggle-display leaflet-control-minimap-toggle-display-"+this.options.position,this._container,this._toggleDisplayButtonClicked,this):void 0,this._toggleDisplayButton.style.width=this.options.collapsedWidth+"px",this._toggleDisplayButton.style.height=this.options.collapsedHeight+"px"},_toggleButtonInitialTitleText:function(){return this.options.minimized?this.options.strings.showText:this.options.strings.hideText},_createButton:function(t,o,i,n,s,r){var a=e.DomUtil.create("a",i,n);a.innerHTML=t,a.href="#",a.title=o;var l=e.DomEvent.stopPropagation;return e.DomEvent.on(a,"click",l).on(a,"mousedown",l).on(a,"dblclick",l).on(a,"click",e.DomEvent.preventDefault).on(a,"click",s,r),a},_toggleDisplayButtonClicked:function(){this._userToggledDisplay=!0,this._minimized?this._restore():this._minimize()},_setDisplay:function(e){e!==this._minimized&&(this._minimized?this._restore():this._minimize())},_minimize:function(){this.options.toggleDisplay?(this._container.style.width=this.options.collapsedWidth+"px",this._container.style.height=this.options.collapsedHeight+"px",this._toggleDisplayButton.className+=" minimized-"+this.options.position,this._toggleDisplayButton.title=this.options.strings.showText):this._container.style.display="none",this._minimized=!0,this._onToggle()},_restore:function(){this.options.toggleDisplay?(this._container.style.width=this.options.width+"px",this._container.style.height=this.options.height+"px",this._toggleDisplayButton.className=this._toggleDisplayButton.className.replace("minimized-"+this.options.position,""),this._toggleDisplayButton.title=this.options.strings.hideText):this._container.style.display="block",this._minimized=!1,this._onToggle()},_onMainMapMoved:function(e){if(this._miniMapMoving)this._miniMapMoving=!1;else{var t=this.options.centerFixed||this._mainMap.getCenter();this._mainMapMoving=!0,this._miniMap.setView(t,this._decideZoom(!0)),this._setDisplay(this._decideMinimized())}this._aimingRect.setBounds(this._mainMap.getBounds())},_onMainMapMoving:function(e){this._aimingRect.setBounds(this._mainMap.getBounds())},_onMiniMapMoveStarted:function(e){if(!this.options.centerFixed){var t=this._aimingRect.getBounds(),o=this._miniMap.latLngToContainerPoint(t.getSouthWest()),i=this._miniMap.latLngToContainerPoint(t.getNorthEast());this._lastAimingRectPosition={sw:o,ne:i}}},_onMiniMapMoving:function(t){this.options.centerFixed||!this._mainMapMoving&&this._lastAimingRectPosition&&(this._shadowRect.setBounds(new e.LatLngBounds(this._miniMap.containerPointToLatLng(this._lastAimingRectPosition.sw),this._miniMap.containerPointToLatLng(this._lastAimingRectPosition.ne))),this._shadowRect.setStyle({opacity:1,fillOpacity:.3}))},_onMiniMapMoved:function(e){this._mainMapMoving?this._mainMapMoving=!1:(this._miniMapMoving=!0,this._mainMap.setView(this._miniMap.getCenter(),this._decideZoom(!1)),this._shadowRect.setStyle({opacity:0,fillOpacity:0}))},_isZoomLevelFixed:function(){var e=this.options.zoomLevelFixed;return this._isDefined(e)&&this._isInteger(e)},_decideZoom:function(e){if(this._isZoomLevelFixed())return e?this.options.zoomLevelFixed:this._mainMap.getZoom();if(e)return this._mainMap.getZoom()+this.options.zoomLevelOffset;var t,o=this._miniMap.getZoom()-this._mainMap.getZoom(),i=this._miniMap.getZoom()-this.options.zoomLevelOffset;return o>this.options.zoomLevelOffset&&this._mainMap.getZoom()<this._miniMap.getMinZoom()-this.options.zoomLevelOffset?this._miniMap.getZoom()>this._lastMiniMapZoom?(t=this._mainMap.getZoom()+1,this._miniMap.setZoom(this._miniMap.getZoom()-1)):t=this._mainMap.getZoom():t=i,this._lastMiniMapZoom=this._miniMap.getZoom(),t},_decideMinimized:function(){return this._userToggledDisplay?this._minimized:this.options.autoToggleDisplay?!!this._mainMap.getBounds().contains(this._miniMap.getBounds()):this._minimized},_isInteger:function(e){return"number"==typeof e},_isDefined:function(e){return void 0!==e},_onToggle:function(){e.Util.requestAnimFrame(function(){e.DomEvent.on(this._container,"transitionend",this._fireToggleEvents,this),e.Browser.any3d||e.Util.requestAnimFrame(this._fireToggleEvents,this)},this)},_fireToggleEvents:function(){e.DomEvent.off(this._container,"transitionend",this._fireToggleEvents,this);var t={minimized:this._minimized};this.fire(this._minimized?"minimize":"restore",t),this.fire("toggle",t)}});return e.Map.mergeOptions({miniMapControl:!1}),e.Map.addInitHook(function(){this.options.miniMapControl&&(this.miniMapControl=(new t).addTo(this))}),t},window)},function(e,t,o){"use strict";o.r(t);var i=o(1);function n(e){return"is_primary"in e&&e.is_primary}function s(e){var t=[],o=e.species;for(var i in o)(n(o[i])||o[i].is_active)&&t.push(o[i]);return function(e){e.sort(function(e,t){return n(e)&&!n(t)?-1:n(t)&&!n(e)?1:e.name<t.name?-1:1})}(t),t.map(function(e){return e.pk})}class r{constructor(e){var t=["subjects","groups"];if(t.forEach(function(t){if(0===Object.keys(e[t]).length)throw new Error("No "+t+" provided")}),0===Object.keys(e.species).length&&!e.species_url)throw new Error("Either species or species_url (or both) should be defined");var o=t.concat(["species","pinpoint_target","species_url"]),i=this;if(o.forEach(function(t){e[t]&&(i[t]=e[t])}),this.pinpoint_observation="observation"==e.pinpoint_target,this.sample_attrs=e.sample_attrs||{},this.active_species=s(e),this.eachGroup(function(e){e.species=[]}),this.species)for(var n in this.species){var r=this.species[n];this.groups[r.group].species.push(+n)}}activateSpecies(e,t){this.species[e]||(this.species[e]=t,this.groups[t.group].species.push(e)),this.species[e].is_active=!0,-1===this.active_species.indexOf(e)&&this.active_species.push(e)}eachSubject(e,t){(void 0!==t?this.groups[t].subjects:Object.keys(this.subjects)).forEach(function(t){e(this.subjects[t],t)},this)}eachSubjectName(e){var t={};for(var o in this.eachSubject(function(e,o){e in t||(t[e]=[]),t[e].push(+o)}),t)e(o,t[o])}_eachSpecies(e,t,o){for(var i in this.species)t&&!t(this.species[i])||e.call(o,this.species[i],this.species[i].pk)}sortActiveSpecies(){this.active_species=s(this)}eachActiveSpecies(e,t){var o=this.active_species;if(void 0!==t){var i=this.groups[t].species;o=o.filter(function(e){return-1!==i.indexOf(e)})}(o=o.map(function(e){return this.species[e]},this)).forEach(function(t){e(t,t.pk)},this)}eachSelectableSpecies(e,t){var o=!1;void 0!==t&&(o=this.groups[t].species),this._eachSpecies(e,function(e){return(!o||-1!==o.indexOf(e.pk))&&!(n(e)||e.is_active)})}eachGroup(e){for(var t in this.groups)e(this.groups[t],t)}getGroupForSpecies(e){for(var t in this.groups){var o=this.groups[t];if(-1!==o.species.indexOf(e.pk))return o}}selectSubjectForSpecies(e,t){var o;return this.getGroupForSpecies(t).subjects.forEach(function(t){-1!==e.indexOf(t)&&(o=t)}),o}hasSampleAttrs(){return!this.pinpoint_observation&&Object.keys(this.sample_attrs).length>0}eachSampleAttr(e){for(var t in this.sample_attrs)e(this.sample_attrs[t],t)}}var a=function(e){var t=this.protocol=new r(e.protocol),o=t.pinpoint_observation;this.samples=e.initial_data||[],o&&0===this.samples.length&&this.samples.push({observations:[]});try{this.samples.forEach(function(e){e.observations.forEach(function(e){e.species&&t.activateSpecies(e.species)})})}catch(e){throw new Error("Could not activate species for initial data. Make sure all species refered to in initial_data are present in protocol.species.")}function s(e){return[(e=L.latLng(e)).lat,e.lng]}this.updateAttribute=function(e,t,o){this.getSample(e).attributes[t]=o},this.getSample=function(e){return o?this.samples[0]:(this.samples.forEach(function(o){o.name==e&&(t=o)}),t);var t},this.getObservation=function(e,t,i){var n,s=this.getSample(e);return s.observations.forEach(function(r){if(o)r.name===e&&(n=r);else{var a=r.species==t&&r.subject==i;s.name==e&&a&&(n=r)}}),n},this.removeObservation=function(e,t,i){var n=this.getSample(e),s=this.getObservation(e,t,i),r=n.observations.indexOf(s);o?s.count=void 0:n.observations.splice(r,1)},this.updateCount=function(e,i,s,r){void 0!==r&&""!==r&&(r=Math.abs(+r));var a=t.species[i],l=this.getSample(e),c=this.getObservation(e,i,s);c&&L.extend(c,{species:i,subject:s,count:r}),!n(a)&&void 0===r||""===r?c&&this.removeObservation(e,i,s):c||o||l.observations.push({species:i,subject:s,count:r})},this.observedCount=function(e,t,o){var i=this.getObservation(e,t,o);return i?i.count:void 0},this.next_pin_name=function(){var e=0;return this.samples.forEach(function(t){o?t.observations.forEach(function(t){e=Math.max(e,+t.name)}):e=Math.max(e,+t.name)}),""+(e+1)},this.createPin=function(e){var t={name:this.next_pin_name(),delete_on_cancel:!0};return o?this.getSample().observations.push(t):(L.extend(t,{observations:[],attributes:{}}),this.samples.push(t)),e&&(t.latlng=s(e)),t},this.createMarker=function(e){var t=Object(i.b)(e.latlng,e.name);return t.feature={properties:e},t},this.setLatLng=function(e,t){this.getPin(e).latlng=s(t)},this.getPin=function(e){return o?this.getObservation(e):this.getSample(e)},this.eachPin=function(e){var t=o?this.samples[0].observations:this.samples;for(var i in t)e(t[i],i)},this.hasObservations=function(e){var t=this.getPin(e);return void 0!==t&&(o?"species"in t:t.observations.length>0)},this.removePin=function(e){var t;for(var i in t=o?this.getSample().observations:this.samples)t[i].name==e&&t.splice(i,1)},this.tableData=function(){var e=[],i=[a("location"),a("species")];o?i.push(a("subject"),a("count")):t.eachSubjectName(function(e){i.push(e)}),e.push(i);var n=this;return this.samples.forEach(function(i){if(o)i.observations.forEach(function(o){var i=t.species[o.species],n=t.subjects[o.subject];e.push([o.name,i,n,o.count])});else{if(i.observations.length<1){var s=[i.name,{name:a("no observations")}];return t.eachSubjectName(function(){s.push("")}),void e.push(s)}t.eachActiveSpecies(function(o){var s=[];t.eachSubjectName(function(e,r){var a=t.selectSubjectForSpecies(r,o);s.push(n.observedCount(i.name,o.pk,a))}),s.some(function(e){return void 0!==e})&&e.push([i.name,o].concat(s))})}}),e},this.serialize=function(){return JSON.stringify(this.samples,null,2)},this._=function(t,o){var i=t;return"messages"in e&&(i=e.messages[t]||t),o?i.charAt(0).toUpperCase()+i.substring(1):i};var a=this._};function l(e){var t,o,i,n;for(o=1,i=arguments.length;o<i;o++)for(t in n=arguments[o])e[t]=n[t];return e}var c=/\{ *([\w_-]+) *\}/g;function u(e,t){return e.replace(c,function(e,o){var i=t[o];if(void 0===i)throw new Error("No value provided for variable "+e);return"function"==typeof i&&(i=i(t)),i})}function p(e,t){var o=t||"";return n(e)&&(o+=" app-transect-species-primary"),u('<span class="{class}" title="{scientific_name}">{name}</span>',{class:o,scientific_name:e.scientific_name||"",name:e.name||"<em>"+e.scientific_name+"</em>"})}var h=class{constructor(e,t,o){this.form_data=e,this.options=t,this.selector=o}render(e){var t,o='<div class="leaflet-number-marker">{name}</div>&nbsp;&nbsp;<span data-pin-name="{name}" class="btn-group btn-group-xs"><span data-target="edit" class="btn btn-default"><i class="fa fa-edit"></i></span>'+(this.options.mapclick_create?'<span data-target="move-marker" class="btn btn-default"><i class="fa fa-map-marker"></i></span>':"")+'<span data-target="delete" class="btn btn-danger"><i class="fa fa-remove"></i></span></span>',i="<thead><tr>";e[0].forEach(function(e){i+="<th>"+e+"</th>"}),i+="</tr>",e.slice(1).forEach(function(e){var n=e[0];i+=void 0===t||t!=n?'<tr class="first"><td>'+u(o,{name:n}):"<tr><td>",i+="</td>",i+="<td>"+p(e[1])+"</td>",e.slice(2).forEach(function(e){i+="<td>"+(e=void 0===e?"":e)+"</td>"}),t=n}),i+="</tbody>",this.selector.html(i)}};function d(e){return function(t){return{original:t,id:void 0===t.id?t.pk:t.id,text:t.name||"<em>"+t.scientific_name+"</em>",is_primary:n(t),group:t.group||e.getGroupForSpecies(t)}}}var m=class{constructor(e,t,o){this.protocol=e,this.group=void 0,this.dropdownParent=t,this.placeholder=o}data(){var e=this.protocol,t=[];function o(e){t.push(e)}return e.pinpoint_observation&&e.eachActiveSpecies(o,this.group),e.eachSelectableSpecies(o,this.group),(t=t.map(d(e))).unshift({id:"",text:this.placeholder}),t}set_group(e){return this.group=e.pk,this}render(e,t){var o={dropdownParent:this.dropdownParent,escapeMarkup:function(e){return e},templateResult:function(e){return"is_primary"in e&&n(e)?'<span class="app-transect-species-primary">'+e.text+"</span>":e.text}};if(this.protocol.species_url){var i=d(this.protocol),s=this.group;if(o.placeholder=this.placeholder,o.ajax={url:this.protocol.species_url,dataType:"json",data:function(e){return{json:!0,group:s,search:e.term,page:e.page||1}},processResults:function(e){return e.results=e.results.map(i),e}},e.select2(o),t){var r=i(t),a=new Option(r.text,r.id,!0,!0);e.append(a),e.trigger({type:"select2:change",params:{data:r}})}}else{if(o.data=this.data(),1==o.data.length)return e.hide(),!1;e.select2(o),t&&e.val(t.pk).trigger("change")}return e}};function f(e){return'<div class="form-group">'+e+"</div>"}function g(e){e=l({type:"text"},e);var t=[];for(var o in e)t.push(o+'="'+e[o]+'"');return"<input "+t.join(" ")+"/>"}var v=function(e,t){var o=e._,i=e.protocol;this.modal=function(n,s){var r=e.getPin(s);n.data("name",s),n.find(".pinpoint-name").html('<div class="leaflet-number-marker">'+s+"</div>"),n.find("form").html('<div class="modal-body"></div>');var a=n.find(".modal-header");if(a.find("label").remove(),t.enable_fix_location_checkbox){a.prepend('<label class="pull-right"><input type="checkbox" /> '+o("fix location",!0)+"</label>");var l="fix_location"in r&&!0===r.fix_location;a.find("input[type=checkbox]").prop("checked",l)}var c=n.find(".modal-body"),u="";i.hasSampleAttrs()&&(u+="<h4>"+o("attributes",!0)+"</h4>",i.eachSampleAttr(function(e,t){var o='<label class="control-label col-sm-4">'+e.name+"</label>";o+='<div class="col-sm-6">';var i=r.attributes[t]||"";e.choices&&e.choices.length>0?(o+='<select data-sample-attr="'+t+'" class="form-control">',e.choices.forEach(function(e){var t=e[0]==i?'selected="selected"':"";o+='<option value="'+e[0]+'" '+t+">"+e[1]+"</option>"}),o+="</select>"):o+=g({type:-1!==["number","color","date","month","password","range","time","text"].indexOf(e.type)?e.type:"text",class:"form-control","data-sample-attr":t,value:i}),u+=f(o+="</div>")}),c.append(u));var h=$(t.modal_selector).find(".modal-content"),d=new m(i,h,o("type the first 4 letters of the species name and select a species",!0));if(i.pinpoint_observation){c.append(f('<select class="form-control species-selector"></select><select class="form-control subject-selector"><option disabled="disabled">'+o("select species first",!0)+"</option></select> "+g({class:"form-control number-input",min:0,name:"count",placeholder:"count"})));var v=e.getObservation(s),_=void 0;if(v&&v.species||!i.species_url&&1==Object.keys(i.species).length){var b=v&&v.species?v.species:Object.keys(i.species)[0];_=i.species[b]}d.render(c.find(".species-selector"),_).on("change",function(){var e=$(this).select2("data")[0];e&&e.original&&L(e.original)});var y=c.find(".subject-selector"),L=function(e){i.activateSpecies(e.pk,e);var o=+y.val(),n=!1,s=[];i.eachSubject(function(e,t){s.push({id:t,text:e}),t==o&&(n=!0)},e.group),y.empty().select2({dropdownParent:$(t.modal_selector).find(".modal-content"),data:s}),o&&n&&y.val(o).trigger("change")};_&&L(_),v&&v.subject&&v.count&&v.subject&&(y.val(v.subject).trigger("change"),c.find('[name="count"]').val(v.count))}else u='<table class="table app-transect-table">',i.eachGroup(function(t){u+="<tr><th>"+t.name+"</th>",i.eachSubject(function(e){u+="<td>"+e+"</td>"},t.pk),u+="</tr>",i.eachActiveSpecies(function(o){u+=function(t,o,n){var s="<tr><td>"+p(o,"form-control-static text-right")+"</td>";return i.eachSubject(function(i,n){var r=e.observedCount(t,o.pk,n);void 0===r&&(r="");var a=g({class:"form-control app-transect-subject-input number-input center-block","data-species":o.pk,"data-subject":n,value:r});s+="<td>"+a+"</td>"},n.pk),s+="</tr>"}(s,o,t)},t.pk),u+=function(e){var t=0;return i.eachSubject(function(){t++},e.pk),'<tr><td><select class="form-control species-selector" data-group="'+e.pk+'"></select></td><td colspan="'+t+'"></td></tr>'}(t)}),u+="</table>",c.append(u),i.eachGroup(function(e){d.set_group(e).render($('.species-selector[data-group="'+e.pk+'"]'))});n.find("form").toggleClass("form-inline",i.pinpoint_observation).toggleClass("form-horizontal",!i.pinpoint_observation)}};var _=class{constructor(e,t,o){this.map=e,this.options=o=l({output_selector:"[name=samples]",modal_selector:"#pinpoint_form",table_selector:"#observations",mapclick_create:!0,create_button_selector:"",enable_fix_location_checkbox:!1,default_fix_location_state:!0,warn_for_unsaved_changes:!0},o),this.modal=$(o.modal_selector),this.table=$(o.table_selector);try{var i=this.form_data=new a(t)}catch(e){return void this.table.html("<h1>Error in protocol: <em>"+e+"</em></h1>")}this.renderer=new v(this.form_data,o),this._=this.form_data._,this.markers={},this.editing_state=!1,this.tableRenderer=new h(i,o,this.table);var n=this;o.mapclick_create&&e.on("click",function(e){if(!n.editing_state){var t=i.createPin(e.latlng);o.enable_fix_location_checkbox&&(t.fix_location=o.default_fix_location_state),n.addMapMarker(i.createMarker(t)),n.showEditor(t.name)}}),o.create_button_selector&&$(o.create_button_selector).on("click",function(){var e=i.createPin();n.showEditor(e.name)});var s=L.latLngBounds();e.geojson_layer&&s.extend(e.geojson_layer.getBounds()),i.eachPin(function(e){if(e.latlng){var t=n.addMapMarker(i.createMarker(e));s.extend(t.getLatLng())}},this),s.isValid()&&e.fitBounds(s.pad(.2)),this.update(),this.initModal(),this.table.on("click","[data-target]",function(){var t=""+$(this).parent().data("pin-name");switch($(this).data("target")){case"move-marker":var o=n.markers[t];alert(i._("click on map to choose new location")),n.editing_state=!0,e.once("click",function(e){L.DomEvent.preventDefault(e),i.setLatLng(t,e.latlng),o.setLatLng(e.latlng),n.update(),n.editing_state=!1,n.dirty=!0});break;case"delete":n.dirty=!0,n.removePin(t);break;default:n.showEditor(t)}}),n.dirty=!1,o.warn_for_unsaved_changes&&(window.onbeforeunload=function(){if(n.dirty)return!0},$(o.output_selector).parents("form").find('input[type="submit"]').on("click",function(){window.onbeforeunload=null}))}initModal(){var e=this.modal,t=this.form_data,o=t._,i=this.renderer,n=this,s=t.protocol.pinpoint_observation;e.on("shown.bs.modal",function(){$(this).find("input").first().focus()}),e.on("hidden.bs.modal",function(){n.update()}),s||e.on("select2:close",".species-selector",function(){var o=e.data("name"),s=+$(this).val();if(""!=s){var r=$(this).select2("data")[0];e.find(".select2-hidden-accessible").select2("destroy"),n.saveEditorData(!0),t.protocol.activateSpecies(s,r.original),i.modal(e,o),e.find('input[data-species="'+s+'"]').first().focus()}});var r=function(){if(s){var t=function(t){var o=$(e).find(t).val();return""!=o&&null!=o&&null!=o};if(!t(".species-selector"))return void alert(o("you must select a species",!0));if(!t(".subject-selector"))return void alert(o("you must select a subject",!0))}n.saveEditorData(),e.modal("hide")};e.on("click","[data-save]",r),e.on("keypress",function(e){13==e.which&&(r(),e.preventDefault())}),e.on("click","[data-dismiss]",function(){var o=t.getPin($(e).data("name"));"delete_on_cancel"in o&&n.removePin(o.name,!0),n.update(),e.modal("hide")})}showEditor(e){this.form_data.protocol.sortActiveSpecies(),this.renderer.modal(this.modal,e),this.modal.modal({backdrop:"static",keyboard:!1})}addMapMarker(e){var t=this;return e.addTo(this.map),e.on("click",function(e){t.showEditor(e.target.feature.properties.name),L.DomEvent.stopPropagation(e)}),this.markers[e.feature.properties.name]=e,e}removePin(e,t){var o=this.form_data._;return!(!t&&!confirm(o("are you sure you want to delete this observation?",!0))||(this.markers[e]&&this.markers[e].removeFrom(this.map),this.form_data.removePin(e),this.update(),0))}saveEditorData(e){e=!0===e;var t=this.modal.data("name"),o=this.form_data,i=o.getPin(t),n=this.modal;o.protocol.pinpoint_observation?o.updateCount(t,+$(".species-selector").val(),+$(".subject-selector").val(),n.find("input.number-input").val()):(i.not_counted&&(i.not_counted=!1),n.find("[data-sample-attr]").each(function(){var e=$(this);o.updateAttribute(t,+e.data("sample-attr"),e.val())}),n.find("input.number-input").each(function(){var e=$(this);o.updateCount(t,+e.data("species"),+e.data("subject"),e.val())})),this.options.enable_fix_location_checkbox&&(i.fix_location=n.find("input[type=checkbox]").prop("checked")),e||(delete i.delete_on_cancel,this.dirty=!0)}update(){$(this.options.output_selector).val(this.form_data.serialize()),this.form_data.protocol.sortActiveSpecies(),this.tableRenderer.render(this.form_data.tableData())}};o(14);o.d(t,"fieldwork",function(){return b});var b={Protocol:r,PinpointController:_,Pinpoint:a,PinpointModal:v,PinpointTable:h,is_primary:n}},function(e,t,o){"use strict";o.r(t);var i=o(0),n=o.n(i),s=(o(7),o(8),o(9),o(10),window.gettext||function(e){return e}),r=n.a.Control.extend({options:{position:"bottomleft"},onAdd:function(){var e=n.a.DomUtil.create("div","scroll-intent-message leaflet-control");return e.innerHTML=s("click map for interaction"),e.style.fontSize="20px",e.style.backgroundColor="white",e.style.border="2px solid gray",e.style.borderRadius="4px",e.style.padding="4px 10px",e.style.display="none",e},hide:function(){this._container.style.display="none"},show:function(){var e=this._map.getSize();this._container.style.left=(e.x-280)/2+"px",this._container.style.bottom="20px",this._container.style.display="block"}});function a(){this.scrollWheelZoom.disable(),this.touchZoom.disable()}function l(e){n.a.DomEvent.preventDefault(e),this.scrollWheelZoom.enable(),this.touchZoom.enable(),this._scrollIntentMessage.hide()}function c(e){var t=(new r).addTo(e);a.call(e),e.on("mouseover",function(){e.scrollWheelZoom.enabled()||t.show()},e),e.on("mouseout",function(){setTimeout(function(){t.hide()},1e3)}),e.on("click touch focus dragstart",l,e),e.on("blur",a,e),e._scrollIntentMessage=t}n.a.Map.include({preventAccidentalScroll:function(){c(this)}});var u=c,p=o(4),h=o.n(p);o(11);n.a.LatLng.toWKT||(n.a.LatLng.prototype.toWKT=function(){return n.a.Util.template("POINT({lng} {lat})",this)}),n.a.Util.parseWKT||(n.a.Util.parseWKT=function(e){if(-1!==e.indexOf("POINT")&&-1!==e.indexOf("(")){var t=e.indexOf("(")+1,o=e.substr(t,e.indexOf(")")-t).split(" ");return n.a.latLng([parseFloat(o[1]),parseFloat(o[0])])}});var d=function(e,t){(t=n.a.extend({center:[51,4],zoom:6,callback:n.a.Util.falseFn,baselayers:{map:n.a.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{minZoom:1,maxZoom:19,attribution:"&copy; OpenStreetMap"})},overlays:{},preventAccidentalScroll:!0,scaleControl:!1,fullscreenControl:!0,searchControl:!1,minimap:!1,layersControlOptions:{collapsed:!1}},t||{})).baselayers instanceof n.a.TileLayer&&(t.baselayers={default:t.baselayers}),e=n.a.DomUtil.get(e),n.a.DomUtil.addClass(e,"teramap");var o=n.a.map(e).setView(t.center,t.zoom);o._container.data=o;var i=Object.keys(t.baselayers)[0];if(localStorage){var s=localStorage.getItem("teramap-remember-basemap");s&&s in t.baselayers&&(i=s),o.on("baselayerchange",function(e){localStorage.setItem("teramap-remember-basemap",e.name)})}if(o.addLayer(t.baselayers[i]),t.layersControlOptions&&(Object.keys(t.baselayers).length>1||Object.keys(t.overlays).length>0)&&(o.layersControl=n.a.control.layers(t.baselayers,t.overlays,t.layersControlOptions).addTo(o)),t.fullscreenControl&&(o.fullscreenControl=n.a.control.fullscreen(n.a.extend({postion:"topleft"},t.fullscreenControl)).addTo(o)),t.scaleControl&&(o.scale=n.a.control.scale(n.a.extend({imperial:!1},t.scaleControl)).addTo(o)),t.searchControl&&new n.a.Control.Geocoder(t.searchControl).addTo(o),t.preventAccidentalScroll&&u(o),t.minimap){var r=n.a.extend({minimapLayer:n.a.tileLayer("https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png")},t.minimap);new h.a(r.minimapLayer,r).addTo(o)}return"function"==typeof t.callback&&t.callback(o),o},m=o(2),f=o.n(m),g=o(1);function v(e){return new L.MakiMarkers.Icon(e)}L.MakiMarkers={apiUrl:"/",defaultColor:"#0a0",defaultIcon:"circle-stroked",defaultSize:"s",smallOptions:{iconSize:[23,35],popupAnchor:[0,-20]},largeOptions:{iconSize:[27,41],popupAnchor:[0,-35]}},L.MakiMarkers.Icon=L.Icon.extend({options:{icon:L.MakiMarkers.defaultIcon,color:L.MakiMarkers.defaultColor,size:L.MakiMarkers.defaultSize,shadowAnchor:null,shadowSize:null,shadowUrl:null,className:"maki-marker"},initialize:function(e){e=L.setOptions(this,e);var t={s:L.MakiMarkers.smallOptions,l:L.MakiMarkers.largeOptions};e.size in t||(e.size="s"),L.extend(e,t[e.size]);var o="pin-"+e.size;null!==e.icon&&(o+="-"+e.icon),null!==e.color&&("#"===e.color.charAt(0)&&(e.color=e.color.substr(1)),o+="+"+e.color),e.iconUrl="/maki"+L.MakiMarkers.apiUrl+o+".png"}}),L.MakiMarkers.icon=v;var _={stroke:"#555555","stroke-width":2,"stroke-opacity":1,fill:"#555555","fill-opacity":.5,"stroke-style":null},b=[["stroke","color"],["stroke-width","weight"],["stroke-opacity","opacity"],["fill","fillColor"],["fill-opacity","fillOpacity"],["stroke-style","dashArray"]];function y(e){return function(e){for(var t={},o=0;o<b.length;o++)t[b[o][1]]=e[b[o][0]];return t}(function(e,t){var o={};for(var i in t)o[i]=void 0===e[i]?t[i]:e[i];return o}(e.properties||{},_))}var x=L.FeatureGroup.extend({options:{filter:function(){return!0},style:y,popupOptions:{closeButton:!1},pointToLayer:function(e,t){var o,i=e.properties||{};if("circle-marker"in i)return(o=y(e)).radius=i["circle-marker"],L.circleMarker(t,o);var n=L.marker(t);return"number-marker"in i?(n.setIcon(Object(g.a)(i["number-marker"])),n):"radius"in i?((o=y(e)).radius=i.radius,L.circle(t,o)):(("marker-size"in i||"marker-symbol"in i||"marker-color"in i)&&n.setIcon&&n.setIcon(v({size:(i["marker-size"]||"large").charAt(0),icon:"marker-symbol"in i&&""!==i["marker-symbol"]?i["marker-symbol"]:"",color:(i["marker-color"]||"7e7e7e").replace("#","")})),n)}},initialize:function(e,t){L.setOptions(this,t),this._layers={},"string"==typeof e?this.loadURL(e):e&&"object"==typeof e&&this.setGeoJSON(e),this.on("click",function(e){var t=e.layer;t.feature&&t.feature.properties&&t.feature.properties["popup-url"]&&f()(t.feature.properties["popup-url"],function(o,i){o||(t.bindPopup(i.responseText),t.openPopup(e.latlng))})})},setGeoJSON:function(e){return this._geojson=e,this.clearLayers(),this._initialize(e),this},getGeoJSON:function(){return this._geojson},loadURL:function(e){return this._request&&"abort"in this._request&&this._request.abort(),this._request=function(e,t){return f()(e,function(e,o){!e&&o&&(o=JSON.parse(o.responseText)),t(e,o)})}(e,L.bind(function(t,o){this._request=null,t&&"abort"!==t.type?(console.error("Could not load features at "+e),this.fire("error",{error:t})):o&&(this.setGeoJSON(o),this.fire("ready"))},this)),this},setFilter:function(e){return this.options.filter=e,this._geojson&&(this.clearLayers(),this._initialize(this._geojson)),this},getFilter:function(){return this.options.filter},_initialize:function(e){var t,o,i=L.Util.isArray(e)?e:e.features;if(i)for(t=0,o=i.length;t<o;t++)(i[t].geometries||i[t].geometry||i[t].features)&&this._initialize(i[t]);else if(this.options.filter(e)){var n=L.GeoJSON.geometryToLayer(e,{pointToLayer:this.options.pointToLayer}),s=this.options.style;s&&"setStyle"in n&&("function"==typeof s&&(s=s(e)),n.setStyle(s)),n.feature=e;var r=e.properties||{},a=function(e){if(!("no-popup"in e))return"popup-content"in e?e["popup-content"]:"description"in e?e.description:void 0}(r);a&&n.bindPopup(a,this.options.popupOptions),"title"in r&&r.title&&n.bindTooltip(r.title),this.addLayer(n)}}});function k(e,t){return new x(e,t)}var M=function(e){return e.getBounds?e.getBounds():n.a.latLngBounds(e.getLatLng(),e.getLatLng())};function w(e,t){var o=d(e,t);if(t&&t.geojson){o.geojson_layer=k(t.geojson).addTo(o);var i=t.geojson.properties;i&&i.legend&&n.a.control.legend({position:"bottomright",buttonHtml:i["legend-title"]||"legend",items:i.legend}).addTo(o)}return o.eachFeatureLayer=function(e){o.eachLayer(function(t){t instanceof x&&e(t)})},o.zoomExtent=function(){var e;o.eachFeatureLayer(function(t){e?e.extend(t.getBounds()):e=t.getBounds()}),e&&e.isValid()&&o.fitBounds(e,{maxZoom:16})},o.zoomExtent(),o.focusOnFeature=function(e,t){var i;o.eachFeatureLayer(function(o){o.eachLayer(function(o){var n=o.feature.properties;e in n&&n[e]==t&&(i?i.extend(M(o)):i=M(o))})}),i&&i.isValid()&&o.fitBounds(i,{maxZoom:16})},o.reload=function(){o.invalidateSize(),o.geojson_layer&&o.zoomExtent()},o.reload(),o}o(12),o(13),o.d(t,"FeatureLayer",function(){return x}),o.d(t,"featureLayer",function(){return k}),o.d(t,"map_with_geojson",function(){return w}),o.d(t,"numberMarker",function(){return g.b})},function(e,t){L.Control.Fullscreen=L.Control.extend({options:{position:"topleft",title:{false:"View Fullscreen",true:"Exit Fullscreen"}},onAdd:function(e){var t=L.DomUtil.create("div","leaflet-control-fullscreen leaflet-bar leaflet-control");return this.link=L.DomUtil.create("a","leaflet-control-fullscreen-button leaflet-bar-part",t),this.link.href="#",this._map=e,this._map.on("fullscreenchange",this._toggleTitle,this),this._toggleTitle(),L.DomEvent.on(this.link,"click",this._click,this),t},_click:function(e){L.DomEvent.stopPropagation(e),L.DomEvent.preventDefault(e),this._map.toggleFullscreen(this.options)},_toggleTitle:function(){this.link.title=this.options.title[this._map.isFullscreen()]}}),L.Map.include({isFullscreen:function(){return this._isFullscreen||!1},toggleFullscreen:function(e){var t=this.getContainer();this.isFullscreen()?e&&e.pseudoFullscreen?this._disablePseudoFullscreen(t):document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():this._disablePseudoFullscreen(t):e&&e.pseudoFullscreen?this._enablePseudoFullscreen(t):t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):t.msRequestFullscreen?t.msRequestFullscreen():this._enablePseudoFullscreen(t)},_enablePseudoFullscreen:function(e){L.DomUtil.addClass(e,"leaflet-pseudo-fullscreen"),this._setFullscreen(!0),this.fire("fullscreenchange")},_disablePseudoFullscreen:function(e){L.DomUtil.removeClass(e,"leaflet-pseudo-fullscreen"),this._setFullscreen(!1),this.fire("fullscreenchange")},_setFullscreen:function(e){this._isFullscreen=e;var t=this.getContainer();e?L.DomUtil.addClass(t,"leaflet-fullscreen-on"):L.DomUtil.removeClass(t,"leaflet-fullscreen-on"),this.invalidateSize()},_onFullscreenChange:function(e){var t=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement;t!==this.getContainer()||this._isFullscreen?t!==this.getContainer()&&this._isFullscreen&&(this._setFullscreen(!1),this.fire("fullscreenchange")):(this._setFullscreen(!0),this.fire("fullscreenchange"))}}),L.Map.mergeOptions({fullscreenControl:!1}),L.Map.addInitHook(function(){var e;if(this.options.fullscreenControl&&(this.fullscreenControl=new L.Control.Fullscreen(this.options.fullscreenControl),this.addControl(this.fullscreenControl)),"onfullscreenchange"in document?e="fullscreenchange":"onmozfullscreenchange"in document?e="mozfullscreenchange":"onwebkitfullscreenchange"in document?e="webkitfullscreenchange":"onmsfullscreenchange"in document&&(e="MSFullscreenChange"),e){var t=L.bind(this._onFullscreenChange,this);this.whenReady(function(){L.DomEvent.on(document,e,t)}),this.on("unload",function(){L.DomEvent.off(document,e,t)})}}),L.control.fullscreen=function(e){return new L.Control.Fullscreen(e)}},function(e,t,o){},function(e,t){
/* @preserve
 * Leaflet Control Geocoder 1.7.0
 * https://github.com/perliedman/leaflet-control-geocoder
 *
 * Copyright (c) 2012 sa3m (https://github.com/sa3m)
 * Copyright (c) 2018 Per Liedman
 * All rights reserved.
 */
this.L=this.L||{},this.L.Control=this.L.Control||{},this.L.Control.Geocoder=function(e){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e;var t=0,o=/[&<>"'`]/g,i=/[&<>"'`]/,n={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};function s(e){return n[e]}function r(o,i,n,s,r){var a="_l_geocoder_"+t++;i[r||"callback"]=a,window[a]=e.Util.bind(n,s);var l=document.createElement("script");l.type="text/javascript",l.src=o+c(i),l.id=a,document.getElementsByTagName("head")[0].appendChild(l)}function a(e,t,o){var i=new XMLHttpRequest;i.onreadystatechange=function(){4===i.readyState&&(200===i.status||304===i.status?o(JSON.parse(i.response)):o(""))},i.open("GET",e+c(t),!0),i.setRequestHeader("Accept","application/json"),i.send(null)}function l(e,t){return e.replace(/\{ *([\w_]+) *\}/g,function(e,n){var r,a=t[n];return void 0===a?a="":"function"==typeof a&&(a=a(t)),null==(r=a)?"":r?(r=""+r,i.test(r)?r.replace(o,s):r):r+""})}function c(t,o,i){var n=[];for(var s in t){var r=encodeURIComponent(i?s.toUpperCase():s),a=t[s];if(e.Util.isArray(a))for(var l=0;l<a.length;l++)n.push(r+"="+encodeURIComponent(a[l]));else n.push(r+"="+encodeURIComponent(a))}return(o&&-1!==o.indexOf("?")?"&":"?")+n.join("&")}var u={class:e.Class.extend({options:{serviceUrl:"https://nominatim.openstreetmap.org/",geocodingQueryParams:{},reverseQueryParams:{},htmlTemplate:function(e){var t=e.address,o=[];return(t.road||t.building)&&o.push("{building} {road} {house_number}"),(t.city||t.town||t.village||t.hamlet)&&o.push('<span class="'+(o.length>0?"leaflet-control-geocoder-address-detail":"")+'">{postcode} {city} {town} {village} {hamlet}</span>'),(t.state||t.country)&&o.push('<span class="'+(o.length>0?"leaflet-control-geocoder-address-context":"")+'">{state} {country}</span>'),l(o.join("<br/>"),t)}},initialize:function(t){e.Util.setOptions(this,t)},geocode:function(t,o,i){a(this.options.serviceUrl+"search",e.extend({q:t,limit:5,format:"json",addressdetails:1},this.options.geocodingQueryParams),e.bind(function(t){for(var n=[],s=t.length-1;s>=0;s--){for(var r=t[s].boundingbox,a=0;a<4;a++)r[a]=parseFloat(r[a]);n[s]={icon:t[s].icon,name:t[s].display_name,html:this.options.htmlTemplate?this.options.htmlTemplate(t[s]):void 0,bbox:e.latLngBounds([r[0],r[2]],[r[1],r[3]]),center:e.latLng(t[s].lat,t[s].lon),properties:t[s]}}o.call(i,n)},this))},reverse:function(t,o,i,n){a(this.options.serviceUrl+"reverse",e.extend({lat:t.lat,lon:t.lng,zoom:Math.round(Math.log(o/256)/Math.log(2)),addressdetails:1,format:"json"},this.options.reverseQueryParams),e.bind(function(t){var o,s=[];t&&t.lat&&t.lon&&(o=e.latLng(t.lat,t.lon),s.push({name:t.display_name,html:this.options.htmlTemplate?this.options.htmlTemplate(t):void 0,center:o,bounds:e.latLngBounds(o,o),properties:t})),i.call(n,s)},this))}}),factory:function(t){return new e.Control.Geocoder.Nominatim(t)}},p={class:e.Control.extend({options:{showResultIcons:!1,collapsed:!0,expand:"touch",position:"topright",placeholder:"Search...",errorMessage:"Nothing found.",queryMinLength:1,suggestMinLength:3,suggestTimeout:250,defaultMarkGeocode:!0},includes:e.Evented.prototype||e.Mixin.Events,initialize:function(t){e.Util.setOptions(this,t),this.options.geocoder||(this.options.geocoder=new u.class),this._requestCount=0},onAdd:function(t){var o,i="leaflet-control-geocoder",n=e.DomUtil.create("div",i+" leaflet-bar"),s=e.DomUtil.create("button",i+"-icon",n),r=this._form=e.DomUtil.create("div",i+"-form",n);return this._map=t,this._container=n,s.innerHTML="&nbsp;",s.type="button",(o=this._input=e.DomUtil.create("input","",r)).type="text",o.placeholder=this.options.placeholder,e.DomEvent.disableClickPropagation(o),this._errorElement=e.DomUtil.create("div",i+"-form-no-error",n),this._errorElement.innerHTML=this.options.errorMessage,this._alts=e.DomUtil.create("ul",i+"-alternatives leaflet-control-geocoder-alternatives-minimized",n),e.DomEvent.disableClickPropagation(this._alts),e.DomEvent.addListener(o,"keydown",this._keydown,this),this.options.geocoder.suggest&&e.DomEvent.addListener(o,"input",this._change,this),e.DomEvent.addListener(o,"blur",function(){this.options.collapsed&&!this._preventBlurCollapse&&this._collapse(),this._preventBlurCollapse=!1},this),this.options.collapsed?"click"===this.options.expand?e.DomEvent.addListener(n,"click",function(e){0===e.button&&2!==e.detail&&this._toggle()},this):e.Browser.touch&&"touch"===this.options.expand?e.DomEvent.addListener(n,"touchstart mousedown",function(e){this._toggle(),e.preventDefault(),e.stopPropagation()},this):(e.DomEvent.addListener(n,"mouseover",this._expand,this),e.DomEvent.addListener(n,"mouseout",this._collapse,this),this._map.on("movestart",this._collapse,this)):(this._expand(),e.Browser.touch?e.DomEvent.addListener(n,"touchstart",function(){this._geocode()},this):e.DomEvent.addListener(n,"click",function(){this._geocode()},this)),this.options.defaultMarkGeocode&&this.on("markgeocode",this.markGeocode,this),this.on("startgeocode",function(){e.DomUtil.addClass(this._container,"leaflet-control-geocoder-throbber")},this),this.on("finishgeocode",function(){e.DomUtil.removeClass(this._container,"leaflet-control-geocoder-throbber")},this),e.DomEvent.disableClickPropagation(n),n},_geocodeResult:function(t,o){if(o||1!==t.length)if(t.length>0){this._alts.innerHTML="",this._results=t,e.DomUtil.removeClass(this._alts,"leaflet-control-geocoder-alternatives-minimized");for(var i=0;i<t.length;i++)this._alts.appendChild(this._createAlt(t[i],i))}else e.DomUtil.addClass(this._errorElement,"leaflet-control-geocoder-error");else this._geocodeResultSelected(t[0])},markGeocode:function(t){return t=t.geocode||t,this._map.fitBounds(t.bbox),this._geocodeMarker&&this._map.removeLayer(this._geocodeMarker),this._geocodeMarker=new e.Marker(t.center).bindPopup(t.html||t.name).addTo(this._map).openPopup(),this},_geocode:function(e){var t=this._input.value;if(e||!(t.length<this.options.queryMinLength)){var o=++this._requestCount,i=e?"suggest":"geocode",n={input:t};this._lastGeocode=t,e||this._clearResults(),this.fire("start"+i,n),this.options.geocoder[i](t,function(t){o===this._requestCount&&(n.results=t,this.fire("finish"+i,n),this._geocodeResult(t,e))},this)}},_geocodeResultSelected:function(e){this.fire("markgeocode",{geocode:e})},_toggle:function(){e.DomUtil.hasClass(this._container,"leaflet-control-geocoder-expanded")?this._collapse():this._expand()},_expand:function(){e.DomUtil.addClass(this._container,"leaflet-control-geocoder-expanded"),this._input.select(),this.fire("expand")},_collapse:function(){e.DomUtil.removeClass(this._container,"leaflet-control-geocoder-expanded"),e.DomUtil.addClass(this._alts,"leaflet-control-geocoder-alternatives-minimized"),e.DomUtil.removeClass(this._errorElement,"leaflet-control-geocoder-error"),this._input.blur(),this.fire("collapse")},_clearResults:function(){e.DomUtil.addClass(this._alts,"leaflet-control-geocoder-alternatives-minimized"),this._selection=null,e.DomUtil.removeClass(this._errorElement,"leaflet-control-geocoder-error")},_createAlt:function(t,o){var i=e.DomUtil.create("li",""),n=e.DomUtil.create("a","",i),s=this.options.showResultIcons&&t.icon?e.DomUtil.create("img","",n):null,r=t.html?void 0:document.createTextNode(t.name);return s&&(s.src=t.icon),i.setAttribute("data-result-index",o),t.html?n.innerHTML=n.innerHTML+t.html:n.appendChild(r),e.DomEvent.addListener(i,"mousedown touchstart",function(o){this._preventBlurCollapse=!0,e.DomEvent.stop(o),this._geocodeResultSelected(t),e.DomEvent.on(i,"click",function(){this.options.collapsed?this._collapse():this._clearResults()},this)},this),i},_keydown:function(t){var o=this,i=function(t){o._selection&&(e.DomUtil.removeClass(o._selection,"leaflet-control-geocoder-selected"),o._selection=o._selection[t>0?"nextSibling":"previousSibling"]),o._selection||(o._selection=o._alts[t>0?"firstChild":"lastChild"]),o._selection&&e.DomUtil.addClass(o._selection,"leaflet-control-geocoder-selected")};switch(t.keyCode){case 27:this.options.collapsed&&this._collapse();break;case 38:i(-1);break;case 40:i(1);break;case 13:if(this._selection){var n=parseInt(this._selection.getAttribute("data-result-index"),10);this._geocodeResultSelected(this._results[n]),this._clearResults()}else this._geocode();break;default:return}e.DomEvent.preventDefault(t)},_change:function(){var t=this._input.value;t!==this._lastGeocode&&(clearTimeout(this._suggestTimeout),t.length>=this.options.suggestMinLength?this._suggestTimeout=setTimeout(e.bind(function(){this._geocode(!0)},this),this.options.suggestTimeout):this._clearResults())}}),factory:function(t){return new e.Control.Geocoder(t)}},h={class:e.Class.extend({initialize:function(e){this.key=e},geocode:function(t,o,i){r("https://dev.virtualearth.net/REST/v1/Locations",{query:t,key:this.key},function(t){var n=[];if(t.resourceSets.length>0)for(var s=t.resourceSets[0].resources.length-1;s>=0;s--){var r=t.resourceSets[0].resources[s],a=r.bbox;n[s]={name:r.name,bbox:e.latLngBounds([a[0],a[1]],[a[2],a[3]]),center:e.latLng(r.point.coordinates)}}o.call(i,n)},this,"jsonp")},reverse:function(t,o,i,n){r("//dev.virtualearth.net/REST/v1/Locations/"+t.lat+","+t.lng,{key:this.key},function(t){for(var o=[],s=t.resourceSets[0].resources.length-1;s>=0;s--){var r=t.resourceSets[0].resources[s],a=r.bbox;o[s]={name:r.name,bbox:e.latLngBounds([a[0],a[1]],[a[2],a[3]]),center:e.latLng(r.point.coordinates)}}i.call(n,o)},this,"jsonp")}}),factory:function(t){return new e.Control.Geocoder.Bing(t)}},d={class:e.Class.extend({options:{serviceUrl:"https://www.mapquestapi.com/geocoding/v1"},initialize:function(t,o){this._key=decodeURIComponent(t),e.Util.setOptions(this,o)},_formatName:function(){var e,t=[];for(e=0;e<arguments.length;e++)arguments[e]&&t.push(arguments[e]);return t.join(", ")},geocode:function(t,o,i){a(this.options.serviceUrl+"/address",{key:this._key,location:t,limit:5,outFormat:"json"},e.bind(function(t){var n,s,r=[];if(t.results&&t.results[0].locations)for(var a=t.results[0].locations.length-1;a>=0;a--)n=t.results[0].locations[a],s=e.latLng(n.latLng),r[a]={name:this._formatName(n.street,n.adminArea4,n.adminArea3,n.adminArea1),bbox:e.latLngBounds(s,s),center:s};o.call(i,r)},this))},reverse:function(t,o,i,n){a(this.options.serviceUrl+"/reverse",{key:this._key,location:t.lat+","+t.lng,outputFormat:"json"},e.bind(function(t){var o,s,r=[];if(t.results&&t.results[0].locations)for(var a=t.results[0].locations.length-1;a>=0;a--)o=t.results[0].locations[a],s=e.latLng(o.latLng),r[a]={name:this._formatName(o.street,o.adminArea4,o.adminArea3,o.adminArea1),bbox:e.latLngBounds(s,s),center:s};i.call(n,r)},this))}}),factory:function(t,o){return new e.Control.Geocoder.MapQuest(t,o)}},m={class:e.Class.extend({options:{serviceUrl:"https://api.mapbox.com/geocoding/v5/mapbox.places/",geocodingQueryParams:{},reverseQueryParams:{}},initialize:function(t,o){e.setOptions(this,o),this.options.geocodingQueryParams.access_token=t,this.options.reverseQueryParams.access_token=t},geocode:function(t,o,i){var n=this.options.geocodingQueryParams;void 0!==n.proximity&&n.proximity.hasOwnProperty("lat")&&n.proximity.hasOwnProperty("lng")&&(n.proximity=n.proximity.lng+","+n.proximity.lat),a(this.options.serviceUrl+encodeURIComponent(t)+".json",n,function(t){var n,s,r,a=[];if(t.features&&t.features.length)for(var l=0;l<=t.features.length-1;l++){n=t.features[l],s=e.latLng(n.center.reverse()),r=n.hasOwnProperty("bbox")?e.latLngBounds(e.latLng(n.bbox.slice(0,2).reverse()),e.latLng(n.bbox.slice(2,4).reverse())):e.latLngBounds(s,s);for(var c={text:n.text,address:n.address},u=0;u<n.context.length;u++){c[n.context[u].id.split(".")[0]]=n.context[u].text}a[l]={name:n.place_name,bbox:r,center:s,properties:c}}o.call(i,a)})},suggest:function(e,t,o){return this.geocode(e,t,o)},reverse:function(t,o,i,n){a(this.options.serviceUrl+encodeURIComponent(t.lng)+","+encodeURIComponent(t.lat)+".json",this.options.reverseQueryParams,function(t){var o,s,r,a=[];if(t.features&&t.features.length)for(var l=0;l<=t.features.length-1;l++)o=t.features[l],s=e.latLng(o.center.reverse()),r=o.hasOwnProperty("bbox")?e.latLngBounds(e.latLng(o.bbox.slice(0,2).reverse()),e.latLng(o.bbox.slice(2,4).reverse())):e.latLngBounds(s,s),a[l]={name:o.place_name,bbox:r,center:s};i.call(n,a)})}}),factory:function(t,o){return new e.Control.Geocoder.Mapbox(t,o)}},f={class:e.Class.extend({options:{serviceUrl:"https://api.what3words.com/v2/"},initialize:function(e){this._accessToken=e},geocode:function(t,o,i){a(this.options.serviceUrl+"forward",{key:this._accessToken,addr:t.split(/\s+/).join(".")},function(t){var n,s,r=[];t.hasOwnProperty("geometry")&&(n=e.latLng(t.geometry.lat,t.geometry.lng),s=e.latLngBounds(n,n),r[0]={name:t.words,bbox:s,center:n}),o.call(i,r)})},suggest:function(e,t,o){return this.geocode(e,t,o)},reverse:function(t,o,i,n){a(this.options.serviceUrl+"reverse",{key:this._accessToken,coords:[t.lat,t.lng].join(",")},function(t){var o,s,r=[];200==t.status.status&&(o=e.latLng(t.geometry.lat,t.geometry.lng),s=e.latLngBounds(o,o),r[0]={name:t.words,bbox:s,center:o}),i.call(n,r)})}}),factory:function(t){return new e.Control.Geocoder.What3Words(t)}},g={class:e.Class.extend({options:{serviceUrl:"https://maps.googleapis.com/maps/api/geocode/json",geocodingQueryParams:{},reverseQueryParams:{}},initialize:function(t,o){this._key=t,e.setOptions(this,o),this.options.serviceUrl=this.options.service_url||this.options.serviceUrl},geocode:function(t,o,i){var n={address:t};this._key&&this._key.length&&(n.key=this._key),n=e.Util.extend(n,this.options.geocodingQueryParams),a(this.options.serviceUrl,n,function(t){var n,s,r,a=[];if(t.results&&t.results.length)for(var l=0;l<=t.results.length-1;l++)n=t.results[l],s=e.latLng(n.geometry.location),r=e.latLngBounds(e.latLng(n.geometry.viewport.northeast),e.latLng(n.geometry.viewport.southwest)),a[l]={name:n.formatted_address,bbox:r,center:s,properties:n.address_components};o.call(i,a)})},reverse:function(t,o,i,n){var s={latlng:encodeURIComponent(t.lat)+","+encodeURIComponent(t.lng)};s=e.Util.extend(s,this.options.reverseQueryParams),this._key&&this._key.length&&(s.key=this._key),a(this.options.serviceUrl,s,function(t){var o,s,r,a=[];if(t.results&&t.results.length)for(var l=0;l<=t.results.length-1;l++)o=t.results[l],s=e.latLng(o.geometry.location),r=e.latLngBounds(e.latLng(o.geometry.viewport.northeast),e.latLng(o.geometry.viewport.southwest)),a[l]={name:o.formatted_address,bbox:r,center:s,properties:o.address_components};i.call(n,a)})}}),factory:function(t,o){return new e.Control.Geocoder.Google(t,o)}},v={class:e.Class.extend({options:{serviceUrl:"https://photon.komoot.de/api/",reverseUrl:"https://photon.komoot.de/reverse/",nameProperties:["name","street","suburb","hamlet","town","city","state","country"]},initialize:function(t){e.setOptions(this,t)},geocode:function(t,o,i){var n=e.extend({q:t},this.options.geocodingQueryParams);a(this.options.serviceUrl,n,e.bind(function(e){o.call(i,this._decodeFeatures(e))},this))},suggest:function(e,t,o){return this.geocode(e,t,o)},reverse:function(t,o,i,n){var s=e.extend({lat:t.lat,lon:t.lng},this.options.reverseQueryParams);a(this.options.reverseUrl,s,e.bind(function(e){i.call(n,this._decodeFeatures(e))},this))},_decodeFeatures:function(t){var o,i,n,s,r,a,l=[];if(t&&t.features)for(o=0;o<t.features.length;o++)n=(i=t.features[o]).geometry.coordinates,s=e.latLng(n[1],n[0]),a=(r=i.properties.extent)?e.latLngBounds([r[1],r[0]],[r[3],r[2]]):e.latLngBounds(s,s),l.push({name:this._decodeFeatureName(i),html:this.options.htmlTemplate?this.options.htmlTemplate(i):void 0,center:s,bbox:a,properties:i.properties});return l},_decodeFeatureName:function(e){return(this.options.nameProperties||[]).map(function(t){return e.properties[t]}).filter(function(e){return!!e}).join(", ")}}),factory:function(t){return new e.Control.Geocoder.Photon(t)}},_={class:e.Class.extend({options:{serviceUrl:"https://api.geocode.earth/v1",geocodingQueryParams:{},reverseQueryParams:{}},initialize:function(t,o){e.Util.setOptions(this,o),this._apiKey=t,this._lastSuggest=0},geocode:function(t,o,i){var n=this;a(this.options.serviceUrl+"/search",e.extend({api_key:this._apiKey,text:t},this.options.geocodingQueryParams),function(e){o.call(i,n._parseResults(e,"bbox"))})},suggest:function(t,o,i){var n=this;a(this.options.serviceUrl+"/autocomplete",e.extend({api_key:this._apiKey,text:t},this.options.geocodingQueryParams),e.bind(function(e){e.geocoding.timestamp>this._lastSuggest&&(this._lastSuggest=e.geocoding.timestamp,o.call(i,n._parseResults(e,"bbox")))},this))},reverse:function(t,o,i,n){var s=this;a(this.options.serviceUrl+"/reverse",e.extend({api_key:this._apiKey,"point.lat":t.lat,"point.lon":t.lng},this.options.reverseQueryParams),function(e){i.call(n,s._parseResults(e,"bounds"))})},_parseResults:function(t,o){var i=[];return e.geoJson(t,{pointToLayer:function(t,o){return e.circleMarker(o)},onEachFeature:function(t,n){var s,r,a={};n.getBounds?r=(s=n.getBounds()).getCenter():(r=n.getLatLng(),s=e.latLngBounds(r,r)),a.name=n.feature.properties.label,a.center=r,a[o]=s,a.properties=n.feature.properties,i.push(a)}}),i}}),factory:function(t,o){return new e.Control.Geocoder.Mapzen(t,o)}},b={class:e.Class.extend({options:{service_url:"https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer"},initialize:function(t,o){e.setOptions(this,o),this._accessToken=t},geocode:function(t,o,i){var n={SingleLine:t,outFields:"Addr_Type",forStorage:!1,maxLocations:10,f:"json"};this._key&&this._key.length&&(n.token=this._key),a(this.options.service_url+"/findAddressCandidates",e.extend(n,this.options.geocodingQueryParams),function(t){var n,s,r,a=[];if(t.candidates&&t.candidates.length)for(var l=0;l<=t.candidates.length-1;l++)n=t.candidates[l],s=e.latLng(n.location.y,n.location.x),r=e.latLngBounds(e.latLng(n.extent.ymax,n.extent.xmax),e.latLng(n.extent.ymin,n.extent.xmin)),a[l]={name:n.address,bbox:r,center:s};o.call(i,a)})},suggest:function(e,t,o){return this.geocode(e,t,o)},reverse:function(t,o,i,n){var s={location:encodeURIComponent(t.lng)+","+encodeURIComponent(t.lat),distance:100,f:"json"};a(this.options.service_url+"/reverseGeocode",s,function(t){var o,s=[];t&&!t.error&&(o=e.latLng(t.location.y,t.location.x),s.push({name:t.address.Match_addr,center:o,bounds:e.latLngBounds(o,o)})),i.call(n,s)})}}),factory:function(t,o){return new e.Control.Geocoder.ArcGis(t,o)}},y={class:e.Class.extend({options:{geocodeUrl:"http://geocoder.api.here.com/6.2/geocode.json",reverseGeocodeUrl:"http://reverse.geocoder.api.here.com/6.2/reversegeocode.json",app_id:"<insert your app_id here>",app_code:"<insert your app_code here>",geocodingQueryParams:{},reverseQueryParams:{}},initialize:function(t){e.setOptions(this,t)},geocode:function(t,o,i){var n={searchtext:t,gen:9,app_id:this.options.app_id,app_code:this.options.app_code,jsonattributes:1};n=e.Util.extend(n,this.options.geocodingQueryParams),this.getJSON(this.options.geocodeUrl,n,o,i)},reverse:function(t,o,i,n){var s={prox:encodeURIComponent(t.lat)+","+encodeURIComponent(t.lng),mode:"retrieveAddresses",app_id:this.options.app_id,app_code:this.options.app_code,gen:9,jsonattributes:1};s=e.Util.extend(s,this.options.reverseQueryParams),this.getJSON(this.options.reverseGeocodeUrl,s,i,n)},getJSON:function(t,o,i,n){a(t,o,function(t){var o,s,r,a=[];if(t.response.view&&t.response.view.length)for(var l=0;l<=t.response.view[0].result.length-1;l++)o=t.response.view[0].result[l].location,s=e.latLng(o.displayPosition.latitude,o.displayPosition.longitude),r=e.latLngBounds(e.latLng(o.mapView.topLeft.latitude,o.mapView.topLeft.longitude),e.latLng(o.mapView.bottomRight.latitude,o.mapView.bottomRight.longitude)),a[l]={name:o.address.label,bbox:r,center:s};i.call(n,a)})}}),factory:function(t){return new e.Control.Geocoder.HERE(t)}},L={class:e.Class.extend({options:{userId:"<insert your userId here>",apiKey:"<insert your apiKey here>",serviceUrl:"https://neutrinoapi.com/"},initialize:function(t){e.Util.setOptions(this,t)},geocode:function(t,o,i){a(this.options.serviceUrl+"geocode-address",{apiKey:this.options.apiKey,userId:this.options.userId,address:t.split(/\s+/).join(".")},function(t){var n,s,r=[];t.hasOwnProperty("locations")&&(t.geometry=t.locations[0],n=e.latLng(t.geometry.latitude,t.geometry.longitude),s=e.latLngBounds(n,n),r[0]={name:t.geometry.address,bbox:s,center:n}),o.call(i,r)})},suggest:function(e,t,o){return this.geocode(e,t,o)},reverse:function(t,o,i,n){a(this.options.serviceUrl+"geocode-reverse",{apiKey:this.options.apiKey,userId:this.options.userId,latitude:t.lat,longitude:t.lng},function(o){var s,r,a=[];200==o.status.status&&o.found&&(s=e.latLng(t.lat,t.lng),r=e.latLngBounds(s,s),a[0]={name:o.address,bbox:r,center:s}),i.call(n,a)})}}),factory:function(t){return new e.Control.Geocoder.Neutrino(t)}},x=e.Util.extend(p.class,{Nominatim:u.class,nominatim:u.factory,Bing:h.class,bing:h.factory,MapQuest:d.class,mapQuest:d.factory,Mapbox:m.class,mapbox:m.factory,What3Words:f.class,what3words:f.factory,Google:g.class,google:g.factory,Photon:v.class,photon:v.factory,Mapzen:_.class,GeocodeEarth:_.class,Pelias:_.class,mapzen:_.factory,geocodeEarth:_.factory,pelias:_.factory,ArcGis:b.class,arcgis:b.factory,HERE:y.class,here:y.factory,Neutrino:L.class,neutrino:L.factory});return e.Util.extend(e.Control,{Geocoder:x,geocoder:p.factory}),x}(L)},function(e,t,o){},function(e,t,o){},function(e,t){L.Control.Legend=L.Control.extend({options:{position:"bottomright",collapsed:!0,buttonHtml:"legend"},onRemove:function(){this._map.off("click",this.collapse,this),this._container=null},onAdd:function(e){return this._map=e,this._initLayout()},_initLayout:function(){var e="leaflet-legend",t=this._container=L.DomUtil.create("div",e),o=this.options.collapsed;t.setAttribute("aria-haspopup",!0),L.DomEvent.disableClickPropagation(t),L.DomEvent.disableScrollPropagation(t),o&&(this._map.on("click",this.collapse,this),L.Browser.android||L.DomEvent.on(t,{mouseover:this.expand,mouseout:this.collapse},this));var i=L.DomUtil.create("a",e+"-toggle",t);i.href="#",i.title="legend",i.innerHTML=this.options.buttonHtml,L.Browser.touch?(L.DomEvent.on(i,"click",L.DomEvent.stop),L.DomEvent.on(i,"click",this.expand,this)):L.DomEvent.on(i,"focus",this.expand,this),o||this.expand();var n=L.DomUtil.create("div",e+"-list");return this.options.items.forEach(function(t){var o=L.DomUtil.create("div",e+"-item",n),i=L.DomUtil.create("div",e+"-color",o);i.innerHTML="&nbsp;",i.style.backgroundColor=t.color,L.DomUtil.create("div",e+"-text",o).innerHTML=t.label}),t.appendChild(n),t},expand:function(){return L.DomUtil.addClass(this._container,"leaflet-legend-expanded"),this},collapse:function(){return L.DomUtil.removeClass(this._container,"leaflet-legend-expanded"),this}}),L.control.legend=function(e){return new L.Control.Legend(e)}},function(e,t,o){},function(e,t,o){},function(e,t,o){"use strict";o.r(t);var i=o(6);o.d(t,"FeatureLayer",function(){return i.FeatureLayer}),o.d(t,"featureLayer",function(){return i.featureLayer}),o.d(t,"map_with_geojson",function(){return i.map_with_geojson}),o.d(t,"numberMarker",function(){return i.numberMarker});var n=o(5);o.d(t,"fieldwork",function(){return n.fieldwork})}]);
//# sourceMappingURL=teramap.js.map